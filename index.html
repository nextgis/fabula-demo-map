<!DOCTYPE html>
<html>
    <head>
        <title>Fabula Demo Map</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.css" />
        <link rel="stylesheet" href="css/MarkerCluster.css" />
        <link rel="stylesheet" href="css/MarkerCluster.Default.css" />
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <script src="http://cdn.leafletjs.com/leaflet-0.7.5/leaflet.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/leaflet.markercluster.js"></script>
    </head>
    <body>
        <div id="map"></div>
        <script src="data/json_crimedataset.js"></script>
        <script>
            var map = L.map('map', {minZoom:1, maxZoom:18, zoomControl:true});
            map.setView([55.72, 37.61], 10);
        
            var hash = new L.Hash(map);

            var basemap = L.tileLayer('http://tiles.maps.sputnik.ru/tiles/kmt2/{z}/{x}/{y}.png', {
                attribution: '<a href="http://nextgis.ru/">NextGIS</a> | &copy; Спутник | &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors,<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
                maxZoom: 18
            }).addTo(map);
        
            var fabula = new L.geoJson(json_crimedataset, {
                onEachFeature: function(feature, layer) {
                    var content = '<table>\
                        <tr><th scope="row">Номер уголовного дела</th><td>' + feature.properties['number'] + '</td></tr>\
                        <tr><th scope="row">Квалификация преступления</th><td>' + feature.properties['stzch'] + '</td></tr>\
                        <tr><th scope="row">Орган, выявивший преступление</th><td>' + feature.properties['kem_text'] + '</td></tr>\
                        <tr><th scope="row">ОКАТО органа</th><td>' + feature.properties['okato'] + '</td></tr>\
                        <tr><th scope="row">ОКТМО органа</th><td>' + feature.properties['oktmo'] + '</td></tr>\
                        <tr><th scope="row">Дата совершения преступления</th><td>' + feature.properties['dt_sov'] + '</td></tr>\
                        <tr><th scope="row">Статус неоконченного преступления</th><td>' + feature.properties['prig_pok'] + '</td></tr>\
                        <tr><th scope="row">Направленность преступления</th><td>' + feature.properties['napr'] + '</td></tr>\
                        <tr><th scope="row">Место совершения преступления</th><td>' + feature.properties['mesto'] + '</td></tr>\
                        <tr><th scope="row">Форма хозяйствующего субъекта</th><td>' + feature.properties['forma_xoz'] + '</td></tr>\
                        <tr><th scope="row">Признак совершения преступления в общественном месте</th><td>' + feature.properties['ob_mesto'] + '</td></tr>\
                        <tr><th scope="row">Предмет преступного посягательства 1</th><td>' + feature.properties['predmet1'] + '</td></tr>\
                        <tr><th scope="row">Предмет преступного посягательства 2</th><td>' + feature.properties['predmet2'] + '</td></tr>\
                        <tr><th scope="row">Предмет преступного посягательства 3</th><td>' + feature.properties['predmet3'] + '</td></tr>\
                        <tr><th scope="row">Оружие 1</th><td>' + feature.properties['oruj1'] + '</td></tr>\
                        <tr><th scope="row">Оружие 2</th><td>' + feature.properties['oruj2'] + '</td></tr>\
                        <tr><th scope="row">Оружие 3</th><td>' + feature.properties['oruj3'] + '</td></tr>\
                        <tr><th scope="row">Количество потерпевших</th><td>' + feature.properties['kol_poterp'] + '</td></tr>\
                    </table>';
                    layer.bindPopup(content);
                }
            });

            var cluster = new L.MarkerClusterGroup({showCoverageOnHover: false});
            cluster.addLayer(fabula);
            cluster.addTo(map);
    </script>
</body>
</html>
